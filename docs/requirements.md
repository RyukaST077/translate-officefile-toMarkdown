# 1. 目的 / 背景

* フォルダ配下の **Excel（.xlsx 等）** と **Word（.docx）** を一括で **Markdown（.md）** に変換し、共有・レビュー・差分管理（Git等）をしやすくする。
* 変換後は元のフォルダ階層を維持し、出力先は入力フォルダ名の末尾に `_md` を付与した新規フォルダにする。

# 2. 対象ユーザー / 利用シーン

* 対象：社内ユーザー（非エンジニアを含む）
* 想定利用：ドキュメント資産のMarkdown化、社内Wiki投入前の変換、Git管理用の整形

# 3. スコープ

## 3.1 対象（IN）

* Windows上で動作するGUIアプリ
* 指定フォルダ配下を再帰的に探索し、Excel/WordをMarkdownへ変換
* フォルダ構造を維持したまま出力
* 変換エンジン：Pythonライブラリ **MarkItDown** を利用

## 3.2 対象外（OUT）※初期案

* PDF、PowerPoint等の変換
* Markdownの高度なレイアウト最適化（見出し再構成など）
* 変換結果の自動レビューや品質スコアリング

# 4. 用語

* **入力フォルダ**：ユーザーが選択する変換対象のルートフォルダ
* **出力フォルダ**：入力フォルダ名末尾に `_md` を付与して作る変換結果格納先

  * 例：`C:\work\docs` → `C:\work\docs_md`

# 5. 機能要件（Functional Requirements）

## 5.1 入出力

* 入力：

  * ルートフォルダ指定（フォルダ選択ダイアログ）
  * 対象拡張子：`.docx`, `.xls`, `.xlsx`（MarkItDownで明示されている拡張子のみ）
* 出力：

  * 出力ルートは入力ルートと同階層に作成し、フォルダ名末尾に `_md`
  * 入力の相対パスを維持して `.md` を生成
  * 既存出力フォルダが存在する場合：**上書きしない**。末尾に連番を付けて新規作成（例：`docs_md` が存在 → `docs_md_2`, `docs_md_3` …）

## 5.2 変換処理

* 再帰探索：サブフォルダ含め全件対象
* 変換：MarkItDownを用いてファイル単位にmd生成
* 変換対象外ファイルは無視（ログに件数のみ記録など）
* 変換失敗が発生しても処理は継続し、失敗内容をログに記録

### 5.2.1 変換品質の許容範囲（表・画像・数式）

* 表：MarkItDownの出力に従う（崩れの完全補正は初期スコープ外）
* 画像：**無視（Markdownに埋め込まない）**

  * 画像の有無を検出できる場合：画像が含まれるシートには注記（例：`## Sheet1（画像あり）`）
  * **検出できない場合：注記は付けず、ログのみ記録**
* 数式：**結果（表示値）のみを反映**（式そのものの出力は不要）

### 5.2.2 Excelの複数シートの出力方針

* **1エクセルブック → 1つのMarkdown**
* 複数シートは1つのmd内にシート順で連結し、各シートは見出しで区切る（例：`## SheetName`）

### 5.2.3 同名衝突の扱い（上書き禁止）

* 同一出力フォルダ内で `.md` の同名が発生する場合、連番を付与して回避（例：`a.md` が存在 → `a_2.md`）

## 5.3 GUI（初期リリース：変換機能のみ）

* 最小構成の画面要素：

  * 入力フォルダ選択
  * 出力先プレビュー表示（自動生成されるパスを表示）
  * 実行ボタン
  * 進捗表示（進捗バー、現在処理中のファイル名：簡易で可）
  * 完了サマリ（成功件数、失敗件数、所要時間）
  * （任意）出力フォルダを開くボタン
* 初期リリースでは、詳細設定UI（除外設定・拡張子選択など）は持たない（固定ルールで実行）
* 例外時：ユーザーに分かるメッセージ（原因/対処の簡易案内）

## 5.4 ログ

* 出力フォルダ配下にログファイル（例：`conversion.log`）
* 記録内容（最低限）：

  * 実行日時、入力/出力パス、アプリバージョン
  * 処理対象件数、成功/失敗、失敗ファイルのパスと例外概要

## 5.5 設定（オプション）

* 除外ルール：

  * 特定フォルダ除外（例：`~$` や `tmp`、`.git`）
  * 拡張子の追加/削除
* 出力オプション：

  * 文字コード（UTF-8固定が基本）
  * 同名ファイル衝突時の扱い

# 6. 非機能要件（Non-Functional Requirements）

## 6.1 動作環境

* OS：Windows 10/11（64bit）
* ネットワーク不要（オフラインで完結）

## 6.2 配布/インストール

* Python未インストールのユーザーでも利用可能：

  * 例：PyInstaller等でPythonランタイム含めて実行ファイル化
* インストーラー形式：例）MSI / exe（いずれか）
* 配布場所：GitHub（社内利用のため、社内GitHub / GitHub Enterprise / 限定公開Repo想定）

  * 配布形態：**GitHub Releases にインストーラー（MSI/EXE）を添付して配布**

## 6.3 セキュリティ/社内利用

* 外部送信なし（テレメトリなし）
* 依存ライブラリのライセンス確認（社内利用可否）

## 6.4 性能目安（暫定）

* 例：1,000ファイルを実用時間内に完了（PCスペック差ありのため目標値は別途）
* UIがフリーズしない（バックグラウンド処理）

# 7. 受け入れ基準（Acceptance Criteria）

* 指定フォルダ配下の対象拡張子（`.docx`, `.xls`, `.xlsx`）について、フォルダ構造を保持して出力フォルダに `.md` が生成される
* 出力フォルダ名が入力フォルダ名 + `_md` となり、既存がある場合は `_md_2`, `_md_3`… のように連番で新規作成される（上書きしない）
* 1つのExcelブックは1つのmdに変換され、複数シートはmd内にシート順でまとまって出力される
* Excelの数式は結果（表示値）のみがmdに反映される
* 画像はmdに埋め込まれない。画像有無を検出できる場合はシート見出し等に注記し、検出できない場合は注記なし＋ログのみ
* 変換に失敗したファイルがあっても処理が継続し、ログに記録される
* Python未インストールのWindows環境で、インストール→起動→変換まで完結できる

# 8. 不明瞭 / 要確認ポイント（残り）

1. **対象拡張子の範囲（確定）**

   * 初期スコープでは `.docx`, `.xls`, `.xlsx` のみ対応（`.doc` / `.xlsm` は対象外）

2. **社内配布時の実務**

   * 署名（コードサイン）要否、SmartScreen/AV誤検知対策、アップデート手順（上書きインストール等）

# 9. 仕様提案（確定：Releases配布フロー）

* 開発側：GitHub Actions等でビルドし、Releasesに **インストーラー（MSI/EXE）** を添付
* 利用者：GitHub Releasesからダウンロード→インストール→起動（clone不要）

  * ※これなら「Python未インストールでも使える」と整合
* 補足：配布先は社内GitHub / GitHub Enterprise / 限定公開Repoを想定

---